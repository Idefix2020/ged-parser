!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).gedParse=e()}(function(){return function n(i,o,a){function s(t,e){if(!o[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);throw(r=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",r}r=o[t]={exports:{}},i[t][0].call(r.exports,function(e){return s(i[t][1][e]||e)},r,r.exports,n,i,o,a)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,r){const o=t=>e=>e.tag===t;const a=t=>e=>e.id===t,s=(n,i)=>{let e=n.filter(e=>"?"!==e.yob&&!isNaN(+e.yob));e.forEach(e=>e.fy=+e.yob);let o=n.filter(e=>"?"===e.yob),t=10;for(;0<o.length&&0<t;){let e=o.slice();e.forEach((r,e)=>{let t=[];i.forEach(e=>{e.source==r.id?t.push({pRole:"source",pType:e.sourceType,other:e.target,oType:e.targetType}):e.target==r.id&&t.push({pRole:"target",pType:e.targetType,other:e.source,oType:e.sourceType})}),t.forEach(t=>{n.forEach(e=>{e.id==t.other&&void 0!==e.fy&&("source"===t.pRole?"HUSB"===t.pType&&"WIFE"===t.oType?r.fy=+e.fy-3:"HUSB"===t.pType&&"CHIL"===t.oType?r.fy=+e.fy-30:"WIFE"===t.pType&&(r.fy=+e.fy-27):"target"===t.pRole&&("WIFE"===t.pType&&"HUSB"===t.oType?r.fy=+e.fy+3:"CHIL"===t.pType&&"HUSB"===t.oType?r.fy=+e.fy+30:"CHIL"===t.pType&&"WIFE"===t.oType&&(r.fy=+e.fy+27)))})}),void 0!==r.fy&&o.splice(e,e+1)}),--t}(r=>{let n=[];r.forEach(e=>{var t;void 0!==e.fy&&(e.fy=e.fy*((t=r).length<=50?3:50<t.length&&t.length<=150?4:150<t.length&&t.length<=250?5:250<t.length?6:void 0),n.push(e.fy))});let t=0;n.forEach(e=>t+=e);let i=t/n.length;r.forEach(e=>{void 0!==e.fy&&(e.fy=-(e.fy-i))})})(n)};const l=(e,t,r)=>{return e.id=e.pointer,e.title=(e=>{e=e.tree.filter(o("TITL"))||[];if(0<e.length)return e[e.length-1].data})(e),e.name=(e=>{let t=(e.tree.filter(o("NAME"))||[])[0];return t?t.data.replace(/\//g,""):"?"})(e),e.firstName=(e=>{const t=(e.tree.filter(o("NAME"))||[])[0];if(t){let e=(t.tree.filter(o("GIVN"))||[])[0];return e?-1!==e.data.search(" ")?e.data.slice(0,e.data.search(" ")):e.data:"?"}return"?"})(e),e.surname=(e=>{const t=(e.tree.filter(o("NAME"))||[])[0];if(!t)return"?";{const r=(t.tree.filter(o("SURN"))||[])[0];return r?-1!==r.data.search(",")?r.data.slice(0,r.data.search(",")):r.data:(nameArr=t.data.split(" "),nameArr.some(e=>"/"===e[0])?nameArr.find(e=>"/"===e[0]).replace(/\//g,""):(nameArr[nameArr.length-1]=nameArr[nameArr.length-1].replace(/\//g,""),1<nameArr.length?nameArr[nameArr.length-1]:"Hrm"))}})(e),e.gender=(e=>{e=(e.tree.filter(o("SEX"))||[])[0];return e?e.data:"Unknown"})(e),e.dob=(e=>{let t=(e.tree.filter(o("BIRT"))||[])[0];if(t){e=(t.tree.filter(o("DATE"))||[])[0];return e?e.data:"?"}return"?"})(e),e.yob=(e=>{let t=(e.tree.filter(o("BIRT"))||[])[0];if(t){let e=(t.tree.filter(o("DATE"))||[])[0];return e?e.data.slice(-4):"?"}return"?"})(e),e.pob=(e=>{let t=(e.tree.filter(o("BIRT"))||[])[0];if(t){e=(t.tree.filter(o("PLAC"))||[])[0];return e?e.data:""}return""})(e),e.dod=(e=>{let t=(e.tree.filter(o("BIRT"))||[])[0],r=(e.tree.filter(o("DEAT"))||[])[0];if(r){e=(r.tree.filter(o("DATE"))||[])[0];return e?e.data:"?"}if(t){let e=(t.tree.filter(o("DATE"))||[])[0];return e?e.data.slice(-4)+100:"?"}return"Present"})(e),e.yod=(e=>{var t=(new Date).getFullYear();let r=(e.tree.filter(o("BIRT"))||[])[0],n=(e.tree.filter(o("DEAT"))||[])[0];if(n){let e=(n.tree.filter(o("DATE"))||[])[0];return e?e.data.slice(-4):"?"}if(!r||n)return"?";{let e=(r.tree.filter(o("DATE"))||[])[0];return!e||e.data.slice(-4)<t-100?"?":"Present"}})(e),e.pod=(e=>{let t=(e.tree.filter(o("DEAT"))||[])[0];if(t){e=(t.tree.filter(o("PLAC"))||[])[0];return e?e.data:""}return""})(e),e.families=(e=>{let t=[],r;var n=e.tree.filter(o("FAMC"))||[];if(n)for(let e=0;e<n.length;e++)0<n[e].tree.length&&("PEDI"==n[e].tree[0].tag?r={frel:n[e].tree[0].data,mrel:n[e].tree[0].data}:"_FREL"==n[e].tree[0].tag&&(r={frel:n[e].tree[0].data,mrel:n[e].tree[1].data})),t.push({id:n[e].data,pedi:r});var i=e.tree.filter(o("FAMS"))||[];if(i)for(let e=0;e<i.length;e++)t.push({id:i[e].data});return t})(e),e.color=((t,e)=>{var r=["#ff7f50","#00b4ff","#fac641","#8a9b0f","#a7dbd8","#a37e58","#ec4913","#a27dbd","#11644d","#b3347c","#359668","#fab8b4","#6de627","#ecd078","#bfcff7","#e08e79","#c44d58","#c4ffeb","#a6b890","#aaaaaa","#ffd3b5","#826942","#d4ee5e","#ecfc85","#666666","#ffa1c3","#6541a3","#75616b","#71cfde","#e0e0e0"],n=(t.tree.filter(o("DSCR"))||[])[0];const i=e.find(e=>e.surname===t.surname);return i?i.count=i.count+1:e.push({surname:t.surname,count:1,color:r[e.length%r.length]}),n?n.data:e.find(e=>e.surname===t.surname).color})(e,r),e.notes=e.tree.filter(o("NOTE")),e.bio=((e,n)=>{if(0!=e.notes.length){let r="";return e.notes.forEach(t=>{0<n.length?n.forEach(e=>{t.data===e.pointer&&(r+=e.data,0<e.tree.length&&e.tree.forEach(e=>r+=e.data))}):r+=t.data}),r}})(e,t),e},f=(i,o)=>{let t=[],r=null;let n=i.tree.filter(function(e){return e.data&&("I"===e.data[1]||"P"===e.data[1])});for(i.tree.filter(e=>{"DIV"!==e.tag&&"MARR"!==e.tag||"DIV"!==r&&(r=e.tag)});1<n.length;){for(let e=1;e<n.length;e++)"CHIL"!=n[0].tag&&("HUSB"==n[0].tag&&"WIFE"==n[e].tag?t.push({source:n[0].data,target:n[e].data,sourceType:n[0].tag,targetType:n[e].tag,type:r}):t.push({source:n[0].data,target:n[e].data,sourceType:n[0].tag,targetType:n[e].tag,type:function(e,t,r){let n=o.filter(a(e));return e=n[0].families.filter(a(i.pointer)),"HUSB"==t?e[0].pedi?e[0].pedi.frel:r.some(e=>"_FREL"===e.tag)?r.find(e=>"_FREL"===e.tag).data:void 0:e[0].pedi?e[0].pedi.mrel:r.some(e=>"_MREL"===e.tag)?r.find(e=>"_MREL"===e.tag).data:void 0}(n[e].data,n[0].tag,n[e].tree)}));n.splice(0,1)}return t};t.exports=e=>{const t=e.filter(o("NOTE"));let r=[];const n=e.filter(o("INDI")).map(e=>l(e,t,r)),i=e.filter(o("FAM"));e=i.reduce((e,t)=>e.concat(f(t,n)),[]);return s(n,e),{nodes:n,links:e,families:i,surnameList:r}}},{}],2:[function(e,t,r){var n=e("tree-crawl"),i=/\s*(0|[1-9]+[0-9]*) (@[^@]+@ |)([A-Za-z0-9_]+)( [^\n\r]*|)/;t.exports.parse=function(e){var t={root:{tree:[]},level:0};return t.pointer=t.root,t=e.split("\n").map(function(e){e=e.match(i);return e?{level:parseInt(e[1],10),pointer:e[2].trim(),tag:e[3].trim(),data:e[4].trimLeft(),tree:[]}:null}).filter(function(e){return e}).reduce(function(e,t){if(t.level===e.level)e.pointer.tree.push(t);else if(t.level>e.level){var r=e.pointer;e.pointer=e.pointer.tree[e.pointer.tree.length-1],e.pointer.tree.push(t),e.pointer.up=r,e.level=t.level}else if(t.level<e.level){for(;t.level<=e.pointer.level&&e.pointer.up;)e.pointer=e.pointer.up;e.pointer.tree.push(t),e.level=t.level}return e},t).root,n(t,function(e){delete e.up,delete e.level},{getChildren:function(e){return e.tree}}),t.tree},t.exports.d3ize=e("./d3ize")},{"./d3ize":1,"tree-crawl":3}],3:[function(e,t,r){var n,i;n=this,i=function(){"use strict";function r(e,t){this.flags=e,this.cursor=t}function p(e,t){return new r(e,t)}function t(e){this.xs=[e],this.top=0}function d(e){return new t(e)}function e(){this.depth=0,this.stack=d({node:null,index:-1})}function c(){return new e}function n(){this.break=!1,this.skip=!1,this.remove=!1,this.replace=null}function h(){return new n}function g(e){return e&&0!==e.length}r.prototype={skip:function(){this.flags.skip=!0},break:function(){this.flags.break=!0},remove:function(){this.flags.remove=!0},replace:function(e){this.flags.replace=e},get parent(){return this.cursor.parent},get depth(){return this.cursor.depth},get level(){return this.cursor.depth+1},get index(){return this.cursor.index}},t.prototype={push:function(e){this.top++,this.top<this.xs.length?this.xs[this.top]=e:this.xs.push(e)},pushArrayReverse:function(e){for(var t=e.length-1;0<=t;t--)this.push(e[t])},pop:function(){var e=this.peek();return this.top--,e},peek:function(){return this.xs[this.top]},isEmpty:function(){return-1===this.top}},e.prototype={moveDown:function(e){this.depth++,this.stack.push({node:e,index:0})},moveUp:function(){this.depth--,this.stack.pop()},moveNext:function(){this.stack.peek().index++},get parent(){return this.stack.peek().node},get index(){return this.stack.peek().index}},n.prototype={reset:function(){this.break=!1,this.skip=!1,this.remove=!1,this.replace=null}};function i(e){this.xs=[e],this.top=0,this.maxLength=0}function f(e){return new i(e)}function u(){this.depth=0,this.index=-1,this.queue=f({node:null,arity:1}),this.levelNodes=1,this.nextLevelNodes=0}function o(e,t,r){for(var n=h(),i=new u,o=p(n,i),a=f(e);!a.isEmpty();){var s,l=a.dequeue();if(n.reset(),t(l,o),n.break)break;n.remove||(i.moveNext(),n.replace&&(l=n.replace),n.skip||g(s=r(l))&&(a.enqueueMultiple(s),i.store(l,s.length))),i.moveForward()}}i.prototype={enqueue:function(e){this.xs.push(e)},enqueueMultiple:function(e){for(var t=0,r=e.length;t<r;t++)this.enqueue(e[t])},dequeue:function(){var e=this.peek();return this.top++,32768===this.top&&(this.xs=this.xs.slice(this.top),this.top=0),e},peek:function(){return this.xs[this.top]},isEmpty:function(){return this.top===this.xs.length}},u.prototype={store:function(e,t){this.queue.enqueue({node:e,arity:t}),this.nextLevelNodes+=t},moveNext:function(){this.index++},moveForward:function(){this.queue.peek().arity--,this.levelNodes--,0===this.queue.peek().arity&&(this.index=0,this.queue.dequeue()),0===this.levelNodes&&(this.depth++,this.levelNodes=this.nextLevelNodes,this.nextLevelNodes=0)},get parent(){return this.queue.peek().node}};function a(e){return e.children}return function(e,t,r){var n;null!=e&&(n=(r=r||{}).order||"pre",r=r.getChildren||a,"pre"===n?function(e,t,r){for(var n=h(),i=c(),o=p(n,i),a=d(e),s=Object.assign({},e);!a.isEmpty();){var l,f=a.pop();if(f!==s){if(n.reset(),t(f,o),n.break)break;n.remove||(i.moveNext(),n.skip||g(l=r(f=n.replace?n.replace:f))&&(a.push(s),a.pushArrayReverse(l),i.moveDown(f)))}else i.moveUp()}}(e,t,r):"post"===n?function(e,t,r){for(var n=h(),i=c(),o=p(n,i),a=d(e),s=d(null);!a.isEmpty();){var l=a.peek(),f=s.peek(),u=r(l);if(n.reset(),l!==f&&g(u))s.push(l),i.moveDown(l),a.pushArrayReverse(u);else{if(l===f&&(s.pop(),i.moveUp()),a.pop(),t(l,o),n.break)break;n.remove||i.moveNext()}}}(e,t,r):"bfs"===n&&o(e,t,r))}},"object"==typeof r&&void 0!==t?t.exports=i():n.crawl=i()},{}],4:[function(e,t,r){const{d3ize:n,parse:i}=e("gedcom-d3");t.exports=function(e){const r=n(i(e));var t={};t.nodes=JSON.parse(JSON.stringify(r.nodes)),t.links=JSON.parse(JSON.stringify(r.links)),t.nodes.forEach(t=>{Object.keys(t).forEach(e=>["id","name","dob"].includes(e)||delete t[e]),t.value=new Date(t.dob).getFullYear(),delete t.dob}),t.links=t.links.filter(e=>"CHIL"==e.targetType),t.links.forEach(t=>{Object.keys(t).forEach(e=>["source","target"].includes(e)||delete t[e]),t.directed=!0});e=t.nodes.filter(e=>e.value!=e.value).map(t=>[t.id,t.name,r.nodes.find(e=>e.name==t.name).dob]);return[t,e]}},{"gedcom-d3":2}]},{},[4])(4)});